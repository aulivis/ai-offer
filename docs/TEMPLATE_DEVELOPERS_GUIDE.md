## Template Developers Guide

This document is meant for external partners who deliver fully composed HTML templates for the PDF offer generator. It explains exactly which variables are available, how the rendering pipeline works, and what we expect from the submitted HTML/CSS so we can copy & paste it into production without extra fixes.

---

### 1. Rendering Model in One Page

- We ship templates as standalone HTML files located under `src/app/pdf/templates/html/<template-name>/<template-name>.html`.
- On the server we inject data via a lightweight Mustache-style engine (`HtmlTemplateEngine`) that understands:
  - `{{variable}}` – escaped output
  - `{{{variable}}}` – unescaped HTML (only for trusted content, e.g. `bodyHtml`)
  - `{{#if flag}}...{{/if}}` – conditional blocks
  - `{{#each list}}...{{/each}}` – loops, each iteration inherits the list item’s properties
- There is **no client-side JavaScript**. Everything must render statically inside the HTML file using inline `<style>` definitions.

---

### 2. Available Data Fields

The renderer passes the following keys to your template. Use them exactly as named (case sensitive).

| Variable                                           | Type                                          | Description                                                                                                                    |
| -------------------------------------------------- | --------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------ |
| `locale`                                           | `string`                                      | IETF language tag (e.g. `hu`, `en`). Bind it to `<html lang="{{locale}}">`.                                                    |
| `title`                                            | `string`                                      | Offer title / heading.                                                                                                         |
| `companyName`                                      | `string`                                      | Issuer company name derived from branding context.                                                                             |
| `issueDate`                                        | `string`                                      | Localized issue date (`2025. január 5.`). Empty string if unknown.                                                             |
| `logoUrl`                                          | `string \| null`                              | Hosted logo URL, already authenticated. Wrap in `{{#if logoUrl}}`.                                                             |
| `logoAlt`                                          | `string`                                      | Accessible alt text for the logo or monogram fallback.                                                                         |
| `monogram`                                         | `string`                                      | Two-letter monogram fallback when no logo exists.                                                                              |
| `tierLabel`                                        | `string`                                      | Pre-localised label (`Prémium csomag` or `Ingyenes csomag`).                                                                   |
| `primaryColorHex` / `secondaryColorHex`            | `string`                                      | Hex colors (e.g. `#2563eb`).                                                                                                   |
| `primaryColorHsl` / `secondaryColorHsl`            | `string`                                      | Ready-to-use `h s% l%` strings for `hsl()` CSS values.                                                                         |
| `bodyHtml`                                         | `string`                                      | Rich HTML generated by AI. **Render via `{{{bodyHtml}}}`** so we preserve markup. Check for existence with `{{#if bodyHtml}}`. |
| `hasPricing`                                       | `boolean`                                     | Indicates whether we have line items. Gate the entire pricing table with it.                                                   |
| `pricingRows`                                      | `Array<{ name, qty, unitPrice, vat, total }>` | Preformatted strings for each line item (`qty` and `vat` are already localized). Loop with `{{#each pricingRows}}`.            |
| `grossTotal`                                       | `string`                                      | Localised total amount (gross).                                                                                                |
| `hasImages`                                        | `boolean`                                     | True if there are image assets or reference photos.                                                                            |
| `images`                                           | `Array<{ src, alt }>`                         | Fully resolved image URLs. Always escape alt text.                                                                             |
| `contactName`, `contactEmail`, `contactPhone`      | `string \| null`                              | Seller contact info.                                                                                                           |
| `companyWebsite`, `companyAddress`, `companyTaxId` | `string \| null`                              | Company metadata.                                                                                                              |
| `termsText`                                        | `string \| null`                              | Plain text fallback for legal / payment terms.                                                                                 |
| `termsItems`                                       | `Array<{ number, title, description }>`       | Parsed numbered list if `termsText` follows `1.` / `2.` pattern. Optional.                                                     |
| `currentYear`                                      | `number`                                      | e.g. `2025` – useful for footer copyright.                                                                                     |
| `offerNumber`                                      | `string \| null`                              | Reserved for future unique numbering – keep placeholder ready.                                                                 |

All string variables injected through `{{variable}}` are sanitized automatically. Triple braces (`{{{ ... }}}`) bypass sanitization – **only use them for `bodyHtml` or other content we explicitly mark as safe**.

---

### 3. Expected HTML Structure

1. **Document shell**
   - Always start with `<!doctype html>` and `<html lang="{{locale}}">`.
   - Keep `<head>` lightweight: meta charset, viewport, optional Google Fonts using `<link>` (no `@import`), and one `<style>` block.
   - Avoid inline `<script>` tags entirely.

2. **CSS**
   - Prefer rem/px units; stick to max-width `56-60rem` for printable A4 layout.
   - Declare color tokens using the provided CSS variables, e.g.
     ```css
     :root {
       --primary: {{primaryColorHsl}};
       --secondary: {{secondaryColorHsl}};
     }
     ```
   - Include dedicated `@media print` rules to remove shadows/backgrounds that do not print well.
   - Do not reference external assets via relative paths (images must come from `images[]`).

3. **Body layout**
   - Recommended sections (feel free to adapt styling):
     1. Hero/header with logo/monogram, offer title, tier label, metadata (`issueDate`, `companyName`).
     2. AI content wrapper that renders `{{{bodyHtml}}}`.
     3. Optional gallery gated behind `{{#if hasImages}}`.
     4. Pricing table guarded by `{{#if hasPricing}}` using `{{#each pricingRows}}`.
     5. Optional terms/testimonials, contact info, footer with `{{currentYear}}`.

4. **Accessibility & semantics**
   - Use headings `<h1>-<h3>` consistently.
   - Provide `alt` text (`{{alt}}`) for all `<img>` tags.
   - Use lists `<ul>/<ol>` for bullet sections; tables for pricing.

---

### 4. Control Flow & Helpers

- **Conditionals**: `{{#if logoUrl}}<img src="{{logoUrl}}" alt="{{logoAlt}}" />{{/if}}`.
- **Loops**:
  ```html
  {{#each pricingRows}}
  <tr>
    <td>{{name}}</td>
    <td>{{qty}}</td>
    <td>{{unitPrice}}</td>
    <td>{{vat}}%</td>
    <td>{{total}}</td>
  </tr>
  {{/each}}
  ```
- **Nested values**: dot-notation works inside `{{ }}` (e.g. `{{contact.email}}`) but keep paths shallow for readability.

---

### 5. Do’s and Don’ts

**Do**

- Keep everything self-contained in one HTML file.
- Gracefully handle missing data (`{{#if ...}}` wrappers around optional sections).
- Use the provided color tokens instead of hard-coded brand colors.
- Constrain layout for both screen preview and A4 export.
- Run `pnpm lint` and `pnpm test:templates` before delivery; ensure the HTML passes formatting/printing checks.

**Don’t**

- Load remote scripts, analytics, or external CSS/JS frameworks.
- Reference hard-coded customer names/prices – always use the variables.
- Assume AI text fits fixed heights; allow paragraphs to grow.
- Use absolute positioning for large blocks (small decorative elements are fine).
- Embed base64 images larger than 1 MB; use provided `images` array instead.

---

### 6. Submission Checklist

1. ✅ **Validation** – open the HTML in a browser, print preview to A4, and ensure nothing overflows the page bounds.
2. ✅ **Data coverage** – test with and without pricing, images, testimonials to confirm `{{#if}}` sections behave.
3. ✅ **Performance** – avoid heavy box-shadows, gradients, or filters that slow down PDF rendering.
4. ✅ **Accessibility** – check heading order, color contrast (WCAG AA), and descriptive alt texts.
5. ✅ **Packaging** – deliver a single `.html` file plus optional static assets (SVG backgrounds, etc.). If you add assets, place them in `/assets` and reference them relatively.

Submit the finished template via Git (preferred) or as a zipped folder. Once we copy it under `src/app/pdf/templates/html/<your-template>/`, it should work immediately without further tweaks.
